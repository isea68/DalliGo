<!DOCTYPE html>
<html lang="ko">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>ì»¤ë®¤ë‹ˆí‹°</title>
</head>

<style>
	#header {
		border: 1px solid black;
		width: 100%;
		height: 500px;
		display: flex;
		justify-content: center;
		align-items: center;
		font-size: 100px;
	}

	#mainboard {
		border: 1px solid black;
		width: 100%;
		height: 100px;
		border-radius: 10px;
		display: flex;
		justify-content: center;
		align-items: center;
		font-size: 50px;
		font-weight: bold;
		margin-top: 20px;
		margin-bottom: 20px;
	}

	#nav-box nav {
		display: flex;
		justify-content: center;
		gap: 10px;
		margin-bottom: 50px;
	}

	.nav-item a {
		display: flex;
		justify-content: center;
		align-items: center;
		padding: 5px 10px;
		border: none;
		font-size: 22px;
		font-weight: 500;
		text-decoration: none;
		color: white;
		height: 50px;
		margin-bottom: 20px;
		border-radius: 15px;
		background-color: #00acc1;
		transition: 0.2s;
	}

	.nav-item a:hover {
		transform: scale(1.05);
		cursor: pointer;
	}

	#search_upload-box {
		display: flex;
		align-items: center;
		gap: 5px;
		width: 100%;
		height: 50px;
	}

	#input_search {
		padding-left: 10px;
	}

	.input_search {
		width: 1100px;
		height: 40px;
		font-size: 20px;
	}

	#search-button {
		height: 45px;
		border: none;
		border-radius: 10px;
		background-color: #00acc1;
	}

	#search-button:hover {
		transform: scale(1.05);
		cursor: pointer;
	}

	#upload-button {
		position: fixed;
		right: 20px;
		bottom: 20px;
		z-index: 999;
	}

	.upload-button {
		display: inline-block;
		margin: 5px;
		width: 150px;
		height: 150px;
		border: none;
		border-radius: 50%;
		background-color: #00acc1;
		font-size: 37px;
		font-weight: 700;
		color: white;
		line-height: 150px;
		text-align: center;
		text-decoration: none;
		cursor: pointer;
	}

	.upload-button:hover {
		transform: scale(1.05);
	}

	.list-box {
		margin-top: 5%;
		width: 100%;
		height: 300px;
		border: 1px solid;
		border-radius: 10px;
		display: flex;
		flex-direction: column;
	}

	.list-box:hover {
		background-color: #00abc10e;
		cursor: pointer;
	}

	.list-header {
		width: 99%;
		height: 40px;
		display: flex;
		justify-content: space-between;
		align-items: center;
		margin: 10px;
	}

	.list-username {
		margin-left: 10px;
		font-size: 30px;
		font-weight: 700;
	}

	.list-date {
		margin-right: 20px;
	}

	.list-title {
		width: 99%;
		height: 500px;
		padding: 20px;
		padding-left: 20px;
		border-radius: 10px;
		font-size: 40px;
	}

	.button-detail {
		margin: 5px;
		width: 75px;
		height: 50px;
		border: none;
		border-radius: 7px;
		background-color: #00acc1;
		font-size: 20px;
		line-height: 50px;
		text-align: center;
		text-decoration: none;
		color: white;
		text-decoration: none;
	}

	.button-detail:hover {
		transform: scale(1.05);
		cursor: pointer;
	}

	.reaction {
		display: flex;
		justify-content: flex-start;
		align-items: center;
		margin: 10px;
	}

	.likes {
		margin: 10px;
	}

	#more-button {
		display: flex;
		justify-content: center;
		align-items: center;
	}

	.more-button {
		width: 200px;
		height: 50px;
		font-size: 25px;
		margin: 10%;
		border-radius: 10px;
		border: none;
		background-color: #00acc1;
		color: white;
	}

	.more-button:hover {
		transform: scale(1.02);
		cursor: pointer;
	}

	footer {
		display: flex;
		justify-content: center;
		align-items: center;
	}
</style>

<body>
	
	<div th:replace="fragment/header :: headerDiv"></div>

	<!-- header-->
	<div id="mainboard">ì»¤ë®¤ë‹ˆí‹°</div>


	<!-- ë„¤ë¹„ê²Œì´ì…˜ ë©”ë‰´ -->
	<div id="nav-box">
		<nav>
			<input type="hidden" id="currentCategory" th:value="${category}">
			<div class="nav-item">
				<a id="info" class="category-btn" data-category="info">ëŸ¬ë‹ì •ë³´/ë…¸í•˜ìš°</a>
			</div>
			<div class="nav-item">
				<a id="review" class="category-btn" data-category="review">ëŒ€íšŒì •ë³´í›„ê¸°</a>
			</div>
			<div class="nav-item">
				<a id="recommend" class="category-btn" data-category="recommend">ëŸ¬ë‹ì½”ìŠ¤ì¶”ì²œ</a>
			</div>
			<div class="nav-item">
				<a id="mate" class="category-btn" data-category="mate">ëŸ¬ë‹ë©”ì´íŠ¸ì†Œëª¨ì„</a>
			</div>
			<div class="nav-item">
				<a id="useditem" class="category-btn" data-category="useditem">ì¤‘ê³ ê±°ë˜</a>
			</div>
			<div class="nav-item">
				<a id="trainshare" class="category-btn" data-category="trainshare">í›ˆë ¨ì¼ì§€/ëª©í‘œê³µìœ </a>
			</div>
			<div class="nav-item">
				<a id="qa" class="category-btn" data-category="qa">Q&A/ììœ ê²Œì‹œíŒ</a>
			</div>
		</nav>
	</div>

	<!-- ê²€ìƒ‰ì°½ -->
	<form th:action="@{/community/search}" method="post">
		<div id="search_upload-box">
			<div id="input_search">
				<input class="input_search" placeholder="ê´€ì‹¬ìˆëŠ” í‚¤ì›Œë“œë¥¼ ê²€ìƒ‰í•˜ì„¸ìš”." name="search">
			</div>
			<button id="search-button" type="submit">
				<svg xmlns="http://www.w3.org/2000/svg" width="50" height="30" fill="currentColor" class="bi bi-search"
					viewBox="0 0 16 16">
					<path
						d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0" />
				</svg>
			</button>
		</div>
	</form>

	<!-- ê¸€ì“°ê¸° ë²„íŠ¼ -->
	<div id="upload-button">
		<a href="/community/post" class="upload-button">ê¸€ì“°ê¸°</a>
	</div>

	<!-- ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸ ë¶€ë¶„-->
	<div id="list-container">
		<div th:fragment="postItems">

			<!-- ì¹´í…Œê³ ë¦¬ ì„ íƒ ì‹œ ì¹´í…Œê³ ë¦¬ ë³„ ì´ ê²Œì‹œë¬¼ ìˆ˜ë¥¼ JSì—ì„œ ì½ë„ë¡ hidden div -->
			<div id="totalCount" data-value="${pagevo.totalCount}" style="display:none"></div>

			<div th:each="item : ${pagevo.list}" class="list-item"
				th:onclick="|location.href='@{/community/detail/{id}(id=${item.id})}'|">

				<div class="list-box">
					<div class="list-header">
						<div class="list-username" th:text="'ëŸ¬ë„ˆ: '+ ${item.nickName} + ' ë‹˜'">ëŸ¬ë„ˆ: ì˜¤ëŠ˜ë„ë‹¬ë ¤ ë‹˜</div>
						<div class="list-date" th:text="${#temporals.format(item.inDate, 'yyyy-MM-dd')}">2025.11.18
						</div>
					</div>

					<div class="list-title" th:text="${item.title}">ì˜¤ëŠ˜ 10km ì™„ì£¼í–ˆì–´ìš”!</div>

					<div class="reaction">
						<div class="likes">ğŸ¤ ì¢‹ì•„ìš”</div>
						<div class="comment">
							<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
								class="bi bi-chat" viewBox="0 0 16 16">
								<path
									d="M2.678 11.894a1 1 0 0 1 .287.801 11 11 0 0 1-.398 2c1.395-.323 2.247-.697 2.634-.893a1 1 0 0 1 .71-.074A8 8 0 0 0 8 14c3.996 0 7-2.807 7-6s-3.004-6-7-6-7 2.808-7 6c0 1.468.617 2.83 1.678 3.894m-.493 3.905a22 22 0 0 1-.713.129c-.2.032-.352-.176-.273-.362a10 10 0 0 0 .244-.637l.003-.01c.248-.72.45-1.548.524-2.319C.743 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7-3.582 7-8 7a9 9 0 0 1-2.347-.306c-.52.263-1.639.742-3.468 1.105" />
							</svg>
							ëŒ“ê¸€
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- ë”ë³´ê¸° ë²„íŠ¼ -->
	<div id="more-button">
		<button id="loadMore" class="more-button" data-page="1">ë”ë³´ê¸°</button>
	</div>
	<hr>

	<!-- ë°”ë‹¥ê¸€-->
	<footer>
		<div id="footer">
			<p>ê°œë°œì : ê¹€ì§€ì˜</p>
		</div>
	</footer>
</body>

</html>
<script>
	// ë”ë³´ê¸° ë²„íŠ¼ í´ë¦­ ì‹œ 
	const loadBtn = document.getElementById('loadMore');
	if (loadBtn) {
		loadBtn.addEventListener('click', function () {
			let page = Number(loadBtn.dataset.page) + 1;

			// 1. í˜„ì¬ ì¹´í…Œê³ ë¦¬ ê°’ ê°€ì ¸ì˜¤ê¸°
			const currentCategoryInput = document.getElementById('currentCategory');
			const category = currentCategoryInput ? currentCategoryInput.value : '';

			// 2. ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¥¼ ë™ì ìœ¼ë¡œ êµ¬ì„±
			let url = `/community/list?page=${page}`;
			if (category) url += `&category=${category}`;

			// 3. ìˆ˜ì •ëœ urlë¡œ fetch ìš”ì²­
			fetch(url)
				.then(res => res.text()) //fetchë¡œ HTML ì¡°ê° ê°€ì ¸ì˜¤ê¸° - ì„œë²„ê°€ HTML fragment ë°˜í™˜
				.then(html => {
					// ì„ì‹œ divë¥¼ ë§Œë“  ì´ìœ : html ì•ˆì—ëŠ” ì „ì²´ fragmentê°€ ë“¤ì–´ìˆì§€ë§Œ, ê·¸ ì•ˆì—ì„œ ê²Œì‹œê¸€(.list-item)ë§Œ ë”°ë¡œ ì¶”ì¶œ
					// ê·¸ëƒ¥ container.innerHTML += html ì²˜ëŸ¼ ë°”ë¡œ ë„£ìœ¼ë©´ ì„œë²„ì—ì„œ <div id="totalCount"> ê°™ì€ hiddenê°’ë„
						// ê°™ì´ ë“¤ì–´ì˜¤ê³ , ë”ë³´ê¸° ë²„íŠ¼ ê³„ì‚°ìš© currentCountë¥¼ ì •í™•í•˜ê²Œ êµ¬í•˜ê¸° ì–´ë ¤ì›€... 
						// ê·¸ë˜ì„œ ì„ì‹œ divì—ì„œ .list-itemë§Œ ì„¸ê³ , í•„ìš”í•˜ë©´ totalCountë„ ê°€ì ¸ì˜¤ê³ , ê·¸ í›„ ì‹¤ì œ í™”ë©´ DOMì— append
						// í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì•ˆì •ì ìœ¼ë¡œ ì²˜ë¦¬ ê°€ëŠ¥
					const temp = document.createElement('div');
					temp.innerHTML = html;
					const newItems = temp.querySelectorAll('.list-item');
					
					// ê°€ì ¸ì˜¨ ê²Œì‹œê¸€ì´ ì—†ìœ¼ë©´ ë²„íŠ¼ ìˆ¨ê¹€
					if (newItems.length === 0) {
						loadBtn.style.display = 'none';
						return;
					}
					
					// ì‹¤ì œ DOM(Document Object Model)ì— ì‚½ì…				
					document.getElementById('list-container').insertAdjacentHTML('beforeend', html);
					loadBtn.dataset.page = page;

					// ê°€ì ¸ì˜¨ ê²Œì‹œê¸€ì´ 10ê°œ ë¯¸ë§Œì´ë©´ ë”ë³´ê¸° ë²„íŠ¼ ìˆ¨ê¹€
					if(newItems.length < 10) loadBtn.style.display = 'none';
				})
				.catch(err => console.error('ê²Œì‹œê¸€ ë¡œë“œ ì‹¤íŒ¨:', err));
		});
	}

	// ì¹´í…Œê³ ë¦¬ í´ë¦­ ì‹œ
	document.querySelectorAll('.category-btn').forEach(btn => {
		btn.addEventListener('click', function () {
			const category = this.getAttribute('data-category');
			const loadBtn = document.getElementById('loadMore');
			const container = document.getElementById('list-container');
			const currentCategoryInput = document.getElementById('currentCategory');


			if (currentCategoryInput) { // ì¶”ê°€
				currentCategoryInput.value = category; // í˜„ì¬ ì„ íƒëœ ì¹´í…Œê³ ë¦¬ ê°’ ì €ì¥
			}

			// fetchë¡œ ì¹´í…Œê³ ë¦¬ ê²Œì‹œê¸€ ê°€ì ¸ì˜¤ê¸°
			fetch(`/community/list?category=${category}&page=1`)
				.then(res => res.text())
				.then(html => {
					const temp = document.createElement('div');
					temp.innerHTML = html;
					const newItems = temp.querySelectorAll('.list-item');
					
					container.innerHTML = html; // ê¸°ì¡´ ê²Œì‹œê¸€ì„ ì¹´í…Œê³ ë¦¬ ë³„ ê²Œì‹œê¸€ë¡œ êµì²´
					// loadMore ë²„íŠ¼ ì´ˆê¸°í™”
					loadBtn.dataset.page = "1";

					// ë¹„êµí•´ì„œ ìˆ¨ê¹€/í‘œì‹œ
					if (newItems.length < 10) {
						loadBtn.style.display = 'none';
					} else {
						loadBtn.style.display = 'block';
					}
				})
				.catch(err => console.error('ê²Œì‹œê¸€ ë¡œë“œ ì‹¤íŒ¨:', err));
		});
	});

</script>