<!DOCTYPE html>
<html lang="ko">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>ì»¤ë®¤ë‹ˆí‹°</title>
</head>

<style>
	body {
		font-family: 'Segoe UI', Tahoma;
		margin: 0;
		background-color: #f4f7f9;
		padding: 100px;
	}

	#mainboard {
		width: 100%;
		height: 100px;
		display: flex;
		justify-content: center;
		align-items: center;
		font-size: 50px;
		font-weight: bold;
		color: black;
		margin-top: 20px;
		margin-bottom: 50px;
	}

	#nav-box nav {
		display: flex;
		justify-content: center;
		gap: 10px;
		margin-bottom: 50px;
	}

	.nav-item a {
		display: flex;
		justify-content: center;
		align-items: center;
		padding: 5px 10px;
		border: none;
		font-size: 20px;
		font-weight: 500;
		text-decoration: none;
		color: black;
		height: 50px;
		margin-bottom: 20px;
		border-radius: 15px;
		background-color: rgb(149, 202, 255);
		transition: 0.2s;
		white-space: nowrap; /* ì¤„ë°”ê¿ˆ ë°©ì§€ */
	}

	.nav-item a:hover {
		transform: scale(1.05);
		cursor: pointer;
	}

	#search-container {
		display: flex;
		justify-content: center;
		align-items: center;
		gap: 5px;
		max-width: 900px;
		height: 50px;
		margin: 0 auto;
	}

	#search-box {
		padding-left: 10px;
	}

	.input_search {
		width: 600px;
		height: 40px;
		font-size: 20px;
		padding-left: 10px;
		border-radius: 10px;
	}

	#search-button {
		height: 45px;
		border: none;
		border-radius: 15px;
		background-color: rgb(184, 191, 254);
	}

	#search-button:hover {
		transform: scale(1.05);
		cursor: pointer;
	}

	#upload-button {
		position: fixed;
		right: 20px;
		bottom: 20px;
		z-index: 999;
	}

	.upload-button {
		display: inline-block;
		margin: 5px;
		width: 130px;
		height: 130px;
		border: none;
		border-radius: 50%;
		background-color: rgb(149, 202, 255);
		font-size: 30px;
		font-weight: 700;
		color: black;
		line-height: 130px;
		text-align: center;
		text-decoration: none;
		cursor: pointer;
	}

	.upload-button:hover {
		transform: scale(1.05);
	}

	.PostDetailPath {
		text-decoration: none;
		color: inherit;
	}

	.list-container{
		display: flex;
		justify-content: center;
	}
	
	.admin-post .list-box{
		height: 180px;
		border: 2px solid #ff6b6b;
		background-color: #fff5f5;
	}

	.list-box {
		margin: 5% auto 0 auto;
		width: 60%;
		height: 300px;
		border-radius: 12px;
		display: flex;
		flex-direction: column;
		background-color: white;
		box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
		padding: 30px;
	}

	.list-box:hover {
		background-color: #24b0c227;
		cursor: pointer;
		box-shadow: 0 8px 25px rgba(0,0,0,0.3);
    	transform: translateY(-3px);
    	transition: 0.3s;
	}

	.list-header {
		width: 99%;
		height: 40px;
		display: flex;
		justify-content: space-between;
		align-items: center;
		margin-bottom: 30px;
	}

	.list-username {
		font-size: 20px;
		font-weight: 700;
		margin-bottom: 30px;
	}

	.list-title {
		width: 99%;
		height: 500px;
		border-radius: 10px;
		font-size: 30px;
	}

	.button-detail {
		margin: 5px;
		width: 75px;
		height: 50px;
		border: none;
		border-radius: 7px;
		background-color: #00acc1;
		font-size: 20px;
		line-height: 50px;
		text-align: center;
		text-decoration: none;
		color: white;
		text-decoration: none;
	}

	.button-detail:hover {
		transform: scale(1.05);
		cursor: pointer;
	}

	.reaction {
		display: flex;
		justify-content: flex-start;
		align-items: center;
	}

	.likes {
		margin-top: 10px;
		margin-right: 10px;
		margin-bottom: 10px;
	}

	footer {
		display: flex;
		justify-content: center;
		align-items: center;
	}
</style>

<body>

	<div th:replace="fragment/header :: headerDiv"></div>

	<!-- header-->
	<div id="mainboard">ì»¤ë®¤ë‹ˆí‹°</div>


	<!-- ë„¤ë¹„ê²Œì´ì…˜ ë©”ë‰´ -->
	<div id="nav-box">
		<nav>
			<input type="hidden" id="currentCategory" th:value="${category}">
			<div class="nav-item">
				<a id="info" class="category-btn" data-category="info">ëŸ¬ë‹ì •ë³´/ë…¸í•˜ìš°</a>
			</div>
			<div class="nav-item">
				<a id="review" class="category-btn" data-category="review">ëŒ€íšŒì •ë³´í›„ê¸°</a>
			</div>
			<div class="nav-item">
				<a id="recommend" class="category-btn" data-category="recommend">ëŸ¬ë‹ì½”ìŠ¤ì¶”ì²œ</a>
			</div>
			<div class="nav-item">
				<a id="mate" class="category-btn" data-category="mate">ëŸ¬ë‹ë©”ì´íŠ¸ì†Œëª¨ì„</a>
			</div>
			<div class="nav-item">
				<a id="useditem" class="category-btn" data-category="useditem">ì¤‘ê³ ê±°ë˜</a>
			</div>
			<div class="nav-item">
				<a id="trainshare" class="category-btn" data-category="trainshare">í›ˆë ¨ì¼ì§€/ëª©í‘œê³µìœ </a>
			</div>
			<div class="nav-item">
				<a id="qa" class="category-btn" data-category="qa">Q&A/ììœ ê²Œì‹œíŒ</a>
			</div>
		</nav>
	</div>

	<!-- ê²€ìƒ‰ì°½ -->
	<form id="searchForm">
		<div id="search-container">
			<div id="search-box">
				<input id="input_search" class="input_search" placeholder="ê´€ì‹¬ìˆëŠ” í‚¤ì›Œë“œë¥¼ ê²€ìƒ‰í•˜ì„¸ìš”." name="search">
			</div>
			<button id="search-button" type="submit">
				<svg xmlns="http://www.w3.org/2000/svg" width="50" height="30" fill="currentColor" class="bi bi-search"
					viewBox="0 0 16 16">
					<path
						d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0" />
				</svg>
			</button>
		</div>
	</form>

	<!-- ê¸€ì“°ê¸° ë²„íŠ¼ -->
	<div id="upload-button">
		<!-- ë¹„íšŒì› ë¡œê·¸ì¸ alertì°½ ì•ˆë‚´ìš©-->
		<input type="hidden" id="alertLogin" th:value="${alertLogin}">
		<a th:href="@{/community/post(category=${category}, search=${search})}" class="upload-button">ê¸€ì“°ê¸°</a>
	</div>

	<!-- ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸ ë¶€ë¶„-->
	<div id="list-container">
		<div th:fragment="postItems">

			<div th:each="item : ${list}" class="list-item" th:classappend="${item.isAdmin == 1} ? ' admin-post' : ''">
				<a class="PostDetailPath"
					th:href="@{/community/detail/{id}(id=${item.id}, category=${category}, search=${search})}">
					<div class="list-box">
						<div class="list-header">
						<div class="list-category" th:text="'ì¹´í…Œê³ ë¦¬: ' + ${item.category}">ì¹´í…Œê³ ë¦¬</div>
						<div class="list-date" th:text="${#temporals.format(item.inDate, 'yyyy-MM-dd')}">2025.11.18</div>
						</div>
							<div class="list-username" th:text="'ëŸ¬ë„ˆ: '+ ${item.nickName} + ' ë‹˜'">ëŸ¬ë„ˆ: ì˜¤ëŠ˜ë„ë‹¬ë ¤ ë‹˜</div>

						<div class="list-title" th:text="${item.title}">ì˜¤ëŠ˜ 10km ì™„ì£¼í–ˆì–´ìš”!</div>

						<div class="reaction">
							<div class="likes" th:text="${item.countLikes > 0} ? 'ì¢‹ì•„ìš” ' + ${item.countLikes} : 'ì¢‹ì•„ìš” 0'">
								ğŸ¤ ì¢‹ì•„ìš”</div>
							<div class="comment"
								th:text="${item.countComments > 0} ? 'ëŒ“ê¸€ ' + ${item.countComments} : 'ëŒ“ê¸€ 0'">
								<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
									class="bi bi-chat" viewBox="0 0 16 16">
									<path
										d="M2.678 11.894a1 1 0 0 1 .287.801 11 11 0 0 1-.398 2c1.395-.323 2.247-.697 2.634-.893a1 1 0 0 1 .71-.074A8 8 0 0 0 8 14c3.996 0 7-2.807 7-6s-3.004-6-7-6-7 2.808-7 6c0 1.468.617 2.83 1.678 3.894m-.493 3.905a22 22 0 0 1-.713.129c-.2.032-.352-.176-.273-.362a10 10 0 0 0 .244-.637l.003-.01c.248-.72.45-1.548.524-2.319C.743 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7-3.582 7-8 7a9 9 0 0 1-2.347-.306c-.52.263-1.639.742-3.468 1.105" />
								</svg>
								ëŒ“ê¸€
							</div>
						</div>
					</div>
				</a>
			</div>
		</div>
	</div>

	<hr>

	<!-- ë°”ë‹¥ê¸€-->
	<footer>
		<div id="footer">
			<p>ê°œë°œì : ê¹€ì§€ì˜</p>
		</div>
	</footer>
</body>

</html>

<script>
	// ë¡œê·¸ì¸ ì•ˆ í–ˆì„ ê²½ìš° alert ë„ìš°ê¸°
	const alertLogin = document.getElementById('alertLogin')?.value;
	if (alertLogin) alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");

	const ListModule = (function () {
		const container = document.getElementById('list-container');
		const currentCategoryInput = document.getElementById('currentCategory');
		const searchInput = document.getElementById('input_search');
		const searchForm = document.getElementById('searchForm');

		// ê³µí†µ fetch í•¨ìˆ˜
		async function fetchList(url) {
			try {
				const res = await fetch(url, {
					method: 'GET',
					headers: {
						"X-Requested-With": "XMLHttpRequest"
					}
				});
				const html = await res.text();
				const temp = document.createElement('div');
				temp.innerHTML = html;
				const items = temp.querySelectorAll('.list-item'); // fragment ì•ˆì˜ ì‹¤ì œ itemë§Œ ì„ íƒ
				return {html, items};
			} catch (err) {
				console.error('ê²Œì‹œê¸€ ë¡œë“œ ì‹¤íŒ¨:', err);
				return {html: '', items: []};
			}
		}

		// ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ í´ë¦­
		async function loadCategory(category) {
			if (currentCategoryInput) currentCategoryInput.value = category;
			const url = `/community/list?category=${encodeURIComponent(category)}`;
			const {html, items} = await fetchList(url);

			container.innerHTML = '';
			items.forEach(item => container.insertAdjacentHTML('beforeend', item.outerHTML));
		}

		// ê²€ìƒ‰ ë¡œì§
		function search(event) {
			event.preventDefault(); // submit ê¸°ë³¸ë™ì‘ ë§‰ê¸°

			const searchValue = searchInput.value.trim();
			if (searchValue === '') {
				alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
				return;
			}

			const url = `/community/list?search=${encodeURIComponent(searchValue)}`;

			fetchList(url).then(({html, items}) => {
				container.innerHTML = '';

				if (items.length === 0) {
					alert("ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.");
					return;
				}

				// list-itemë§Œ append
				items.forEach(item => {
					container.insertAdjacentHTML('beforeend', item.outerHTML);
				});
			});
		}

		// ì´ˆê¸°í™”: ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì—°ê²°
		function init() {
			if (searchForm) searchForm.addEventListener('submit', search);
			document.querySelectorAll('.category-btn').forEach(btn => {
				btn.addEventListener('click', () => loadCategory(btn.dataset.category));
			});
		}

		return {init};
	})();

	// DOM ì¤€ë¹„ í›„ ì´ˆê¸°í™”
	document.addEventListener("DOMContentLoaded", () => ListModule.init());
</script>