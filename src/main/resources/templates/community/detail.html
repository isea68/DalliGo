<!DOCTYPE html>
<html lang="ko">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>ê²Œì‹œê¸€ ì œëª©</title>
</head>

<style>
	#mainboard {
		display: flex;
		justify-content: flex-start;
	}

	#main-back {
		margin-top: 25px;
		text-decoration: none;
		color: black;
	}

	#main-back:hover {
		transform: scale(1.05);
		cursor: pointer;
	}

	#main-title {
		padding-left: 30%;
		font-size: 100px;
	}

	.detail-box {
		margin-top: 5%;
		width: 100%;
		border: 1px solid;
		border-radius: 10px;
		display: flex;
		flex-direction: column;
		margin-bottom: 10px;
		padding-bottom: 30px;
	}

	.list-header {
		display: flex;
		justify-content: space-between;
		align-items: center;
	}

	.list-username {
		margin: 10px;
		font-size: 30px;
		font-weight: 500;
	}

	.list-date {
		margin-right: 20px;
		font-size: 20px;
	}

	.list-button {
		margin-right: 20px;
		display: flex;
		justify-content: flex-end;
		align-items: center;
		width: 99%;
	}

	.button-detail {
		margin: 5px;
		width: 75px;
		height: 50px;
		border: none;
		border-radius: 7px;
		background-color: #00acc1;
		font-size: 18px;
		line-height: 40px;
		text-align: center;
		text-decoration: none;
		color: white;
	}

	.button-detail:hover {
		transform: scale(1.05);
		cursor: pointer;
	}

	.button-detail {
		margin: 5px;
		margin-right: 15px;
		width: 60px;
		height: 40px;
	}

	.list-title {
		margin-left: 10px;
		margin-top: 5%;
		margin-bottom: 5%;
		font-size: 40px;
		font-weight: 700;
	}

	.list-content {
		margin: 10px;
		font-size: 25px;
		margin-bottom: 100px;
	}

	#file-box {
		margin-left: 10px;
		margin-top: 20px;
	}

	.reaction {
		display: flex;
		justify-content: flex-start;
		font-size: 30px;
		margin-bottom: 30px;
	}

	.likes {
		cursor: pointer;
	}

	.comment {
		margin-left: 30%;
		cursor: pointer;
	}

	.comment-box {
		border: 1px solid;
		border-radius: 10px;
		margin-bottom: 10px;
	}

	.comment-header {
		display: flex;
		justify-content: space-between;
		margin: 10px;
		margin-bottom: 20px;
	}

	.comment-button {
		display: flex;
		justify-content: flex-end;
		margin-bottom: 10px;
	}

	.comment-date {
		margin-right: 10px;
	}

	.comment-username {
		font-size: 20px;
		font-weight: 600;
	}

	.comment-text {
		margin: 10px;
		font-size: 20px;
		margin-bottom: 20px;
	}

	.modal {
		display: none;
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background-color: rgba(0, 0, 0, 0.5);
		z-index: 999;
	}

	#insert-comment {
		border: 1px solid;
		display: flex;
		align-items: center;
		border-radius: 10px;
		width: 100%;
		height: 100px;
		box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
		position: fixed;
		bottom: 0;
		left: 0;
		animation: fadeIn 0.25s ease;
	}

	@keyframes fadeIn {
		from {
			opacity: 0;
			transform: scale(0.9);
		}

		to {
			opacity: 1;
			transform: scale(1);
		}
	}

	#input-comment {
		width: 90%;
		height: 90%;
		border-radius: 10px;
		margin: 10px;
		font-size: 20px;
	}

	#insert-button {
		width: 90px;
		height: 90px;
		font-size: 30px;
		font-weight: 700;
		border: none;
		border-radius: 10px;
		background-color: #00acc1;
	}

	#insert-button:hover {
		transform: scale(1.02);
		cursor: pointer;
	}

	footer {
		display: flex;
		justify-content: center;
		align-items: center;
	}
</style>

<body>

	<!-- ë©”ì¸ë³´ë“œ -->
	<div id="mainboard">
		<a id="main-back" th:href="@{/community/list(category=${category}, search=${search})}">
			<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" fill="currentColor"
				class="bi bi-arrow-left-square-fill" viewBox="0 0 16 16">
				<path
					d="M16 14a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2zm-4.5-6.5H5.707l2.147-2.146a.5.5 0 1 0-.708-.708l-3 3a.5.5 0 0 0 0 .708l3 3a.5.5 0 0 0 .708-.708L5.707 8.5H11.5a.5.5 0 0 0 0-1" />
			</svg>
		</a>
		<div id="main-title">ì»¤ë®¤ë‹ˆí‹°</div>
	</div>

	<!-- ê²Œì‹œê¸€ ìì„¸íˆ ë³´ê¸°-->
	<div class="detail-box">
		
		<div class="list-header">
			<div class="list-username" th:text="'ëŸ¬ë„ˆ: ' + ${detail.nickName} + ' ë‹˜'">ëŸ¬ë„ˆ: ì˜¤ëŠ˜ë„ë‹¬ë ¤ ë‹˜</div>
			<div class="list-date" th:text="${#temporals.format(detail.inDate, 'yyyy-MM-dd')}">2025.11.18</div>
		</div>

		<th:block th:if="${loginUser != null and loginUser.userId == detail.userId}">
			<div class="list-button">
				<a class="button-detail" th:href="@{/community/update/{id}(id=${detail.id})}">ìˆ˜ì •</a>
				<a class="button-detail" th:href="@{/community/delete/{id}(id=${detail.id})}"
					onclick=" return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">ì‚­ì œ</a>
			</div>
		</th:block>

		<div class="list-title" th:text="${detail.title}">ì˜¤ëŠ˜ 10km ì™„ì£¼í–ˆì–´ìš”!</div>

		<div class="list-content" th:text="${detail.content}">
			ì•ˆë…•í•˜ì„¸ìš”

			ì¤‘ì•™ê·¸ë£¹ ì—°íƒ„ëŸ° ì‚¬ë¬´êµ­ì…ë‹ˆë‹¤.


			ì§€ë‚œ 9ì›” 15ì¼ ë¶€í„° 11ì›” 14ì¼ ê¹Œì§€ ì§„í–‰ëœ ì—°íƒ„ëŸ°ì´
			ì—¬ëŸ¬ë¶„ì˜ ì„±ì›ìœ¼ë¡œ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.

			ê¸°ê°„ ì¤‘ ì´ 5,751ëª…ì´ ì—°íƒ„ëŸ°ì— ì‹ ì²­í•´ ì£¼ì…¨ê³ 
			4,959ëª…ì´ ì¸ì¦í•´ ì£¼ì…¨ìŠµë‹ˆë‹¤.

			ì—¬ëŸ¬ë¶„ì´ ëª¨ì•„ì£¼ì‹  ë”°ëœ»í•œ ë§ˆìŒì€ ì—°íƒ„ 6ë§Œì¥ê³¼ ë‚œë°©ìœ ,

			ë‚œë°©ìš©í’ˆìœ¼ë¡œ ì—ë„ˆì§€ ì·¨ì•½ê³„ì¸µì—ê²Œ ì§€ì›í•  ì˜ˆì •ì…ë‹ˆë‹¤.



			ì¤‘ì•™ê·¸ë£¹ì€ 2020ë…„ ì—ë„ˆì§€ ì·¨ì•½ê³„ì¸µì˜ ë”°ëœ»í•œ ê²¨ìš¸ë‚˜ê¸°ë¥¼ ì§€ì›í•˜ê¸° ìœ„í•´ ì—°íƒ„ ë‚˜ëˆ”ì„ ì‹œì‘í•˜ì˜€ìŠµë‹ˆë‹¤.
			2021ë…„ë¶€í„°ëŠ” KT&G,(ì‚¬)ìœ„ìŠ¤íƒ€íŠ¸ì™€ í•¨ê»˜ ì–¸íƒíŠ¸ ê¸°ë¶€ëŸ°ì¸ â€˜ì—°íƒ„ëŸ°â€™ì„ ë¡ ì¹­í•˜ê³  ì¼ë°˜ ì‹œë¯¼ê¹Œì§€ ì°¸ì—¬í•˜ëŠ” ìº í˜ì¸ìœ¼ë¡œ ì„±ì¥í–ˆìŠµë‹ˆë‹¤. ë³¸ í™œë™ì˜ ì·¨ì§€ì— ê³µê°í•´ ë§¤ë…„ ì—°íƒ„ëŸ°ì— ì°¸ì—¬í•˜ëŠ” ì¼ë°˜ ëŒ€ì¤‘ë“¤ë„
			ëŠ˜ì–´ë‚˜ë©° ì§€ë‚œ 5ë…„ê°„ ì´ 1ë§Œ ëª… ì´ìƒì˜ ë§ˆìŒì´ ëª¨ì—¬ 2,000ì—¬ ê°€êµ¬ë¥¼ ì§€ì›í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

			ì—¬ëŸ¬ë¶„ì˜ ì„±ì›ì— ë‹¤ì‹œí•œë²ˆ ê°ì‚¬ë“œë¦¬ë©°
			ë‚´ë…„ì—ë„ ì°¾ì•„ëµ™ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.



			CUìƒí’ˆê¶Œ ë‹¹ì²¨ì(30ëª…)ëŠ”

			ê¸ˆì£¼ì¤‘ìœ¼ë¡œ ê°œë³„ ì—°ë½ë“œë¦¬ê² ìŠµë‹ˆë‹¤.
			ê°ì‚¬í•©ë‹ˆë‹¤.
		</div>

		<!-- ì—…ë¡œë“œí•œ íŒŒì¼ ëª©ë¡-->
		<div>
			<table>
				<tr th:each="filevo : ${detail.fileList}">
					<td>
						<img th:if="${filevo.savedName != null
										            and (#strings.endsWith(#strings.toLowerCase(filevo.savedName),'jpg')
										                 or #strings.endsWith(#strings.toLowerCase(filevo.savedName),'png')
										                 or #strings.endsWith(#strings.toLowerCase(filevo.savedName),'gif'))}"
							th:src="@{/community/file/download(savedName=${filevo.savedName})}" />

					</td>
					<td>
						<a th:href="@{/community/file/download(savedName=${filevo.savedName})}"
							th:text="${filevo.originalName}"></a>
					</td>
				</tr>
			</table>
		</div>

	</div>

	<!-- ì¢‹ì•„ìš”, ëŒ“ê¸€ ë¶€ë¶„ -->
	<div class="reaction">
		<!-- ì¢‹ì•„ìš” -->
		<div class="likes" id="like-btn">
			<span class="heart" th:text="${isLikeByUser} ? 'â¤ï¸' : 'ğŸ¤'">ğŸ¤ ì¢‹ì•„ìš”</span>
			<span id="like-count" th:text="${countLikes > 0} ? ${countLikes} : 'ì¢‹ì•„ìš”'"></span>
		</div>
		<!-- ëŒ“ê¸€ -->
		<div class="comment" id="comment-btn">ğŸ’¬ ëŒ“ê¸€</div>
	</div>

	<!-- ëŒ“ê¸€ ëª©ë¡ -->
	<div id="comment-container" class="comment-container">
		<div class="comment-box" th:each="item : ${commentList}">
			<div class="comment-header">
				<div class="comment-username" th:text="${item.nickName}">í˜„ëª…í•œ ëŸ°ë‹í™”</div>
				<div class="comment-date" th:text="${#temporals.format(item.inDate, 'yyyy-MM-dd')}">2025.11.19</div>
			</div>

			<div class="comment-text" th:text="${item.content}">ìˆ˜ê³  ë§ìœ¼ì…¨ìŠµë‹ˆë‹¤!!</div>

			<div class="comment-button">
				<th:block th:if="${loginUser != null and loginUser.userId == item.userId}">
					<button type="button" class="button-detail button-mod" th:data-id="${item.id}">ìˆ˜ì •</button>
					<button type="button" class="button-detail button-del" th:data-id="${item.id}"> ì‚­ì œ</button>
					</button>
				</th:block>
			</div>
		</div>
	</div>

	<!-- ëŒ“ê¸€ë‹¬ê¸° ëª¨ë‹¬ì°½ -->
	<div id="modal" class="modal">
		<div id="insert-comment">
			<input type="hidden" id="postId" name="postId" th:value="${detail.id}"> <!-- ì¢‹ì•„ìš”, ëŒ“ê¸€ìš© postId-->
			<input type="hidden" id="commentId" value=""> <!-- ìˆ˜ì •ìš© commentId -->
			<input id="input-comment" name="content" placeholder="ëŒ“ê¸€ì„ ë‚¨ê²¨ì£¼ì„¸ìš”">
			<button id="insert-button">ê²Œì‹œ</button>
		</div>
	</div>

	<!-- ë°”ë‹¥ê¸€-->
	<footer>
		<div id="footer">
			<p>ê°œë°œì : ê¹€ì§€ì˜</p>
		</div>
	</footer>

</body>

</html>

<script>
	document.addEventListener('DOMContentLoaded', () => {
		// ì¢‹ì•„ìš”, ëŒ“ê¸€ì—ì„œ ì“¸ ê³µí†µ ê²Œì‹œê¸€ ë²ˆí˜¸
		const postId = parseInt(document.getElementById('postId').value, 10);
		
		//ì¢‹ì•„ìš” ë²„íŠ¼
		const likeBtn = document.getElementById('like-btn');
		const heart = likeBtn.querySelector('.heart');
		const likeCountSpan = document.getElementById('like-count');

		likeBtn.addEventListener('click', async () => {
			try{
				const response = await fetch(`/community/post/${postId}/like`, { method: "POST" });
				const data = await response.json(); // { liked: true/false, count: ìˆ«ì }
				
				// í•˜íŠ¸ìƒ‰ ë°”ê¾¸ê¸°
				if(data.liked){
					heart.innerText = 'â¤ï¸'; // ë¹¨ê°„ í•˜íŠ¸
				}else {
					heart.innerText = 'ğŸ¤'; // ë¹ˆ í•˜íŠ¸
				}commentBtn
				
				// ì¢‹ì•„ìš” ìˆ˜ë„ í•¨ê»˜ ê°±ì‹ 
				likeCountSpan.innerText = data.count;
			}catch (err) {
				console.error(err);
				alert("ì¢‹ì•„ìš” ì²˜ë¦¬ ì¤‘ ìš”ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
			}
		});

		// ëŒ“ê¸€ ë“±ë¡, ìˆ˜ì •, ì‚­ì œ
		const modal = document.getElementById('modal');
		const commentBtn = document.querySelector('.reaction .comment'); // ëŒ“ê¸€ ë²„íŠ¼ ì„ íƒ
		const insertBtn = document.getElementById('insert-button');
		const inputComment = document.getElementById('input-comment');
		const commentContainer = document.getElementById('comment-container');

		let editingCommentId = null; // nullì´ë©´ ìƒˆ ëŒ“ê¸€, ìˆ«ìë©´ ìˆ˜ì • ì¤‘

		// ëŒ“ê¸€ í´ë¦­ ì‹œ ëª¨ë‹¬ì°½ ì—´ê¸°
		if (commentBtn) {
			commentBtn.addEventListener('click', () => {
				modal.style.display = 'block';
				inputComment.value = '';
				editingCommentId = null; // ìƒˆ ëŒ“ê¸€ ëª¨ë“œ
			});
		}

		// ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
		modal.addEventListener('click', (e) => {
			if (e.target === modal) {
				modal.style.display = 'none';
				inputComment.value = '';
				editingCommentId = null;
			}
		});

		// ëŒ“ê¸€ ë“±ë¡ / ìˆ˜ì •
		insertBtn.addEventListener('click', async () => {
			const content = inputComment.value.trim();
			if (!content) return alert('ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”.');

			try {
				let response, comment;

				if (editingCommentId) {
					response = await fetch(`/community/modComment/${editingCommentId}`, {
						method: 'PUT',
						headers: {'Content-Type': 'application/json'},
						body: JSON.stringify({content})
					});
					if (!response.ok) throw new Error('ìˆ˜ì • ì‹¤íŒ¨');

					comment = await response.json();

					// í™”ë©´ ê°±ì‹ 
					const commentBox = commentContainer.querySelector(`[data-comment-id="${editingCommentId}"]`);
					commentBox.querySelector('.comment-text').innerText = comment.content;

				} else {
					// ìƒˆ ëŒ“ê¸€ ë“±ë¡
					response = await fetch('/community/uploadComment', {
						method: 'POST',
						headers: {'Content-Type': 'application/json'},
						body: JSON.stringify({postId, content})
					});
					const data = await response.json(); // ì„œë²„ì—ì„œ ë°›ì€ JSON
					if (!response.ok) throw new Error(data.message || 'ëŒ“ê¸€ ë“±ë¡ ì‹¤íŒ¨');

					comment = data;

					// í™”ë©´ì— ì¶”ê°€
					const commentBox = document.createElement('div');
					commentBox.classList.add('comment-box');
					commentBox.setAttribute('data-comment-id', comment.id);
					commentBox.innerHTML = `
										<div class="comment-header">
											<div class="comment-username">${comment.nickName}</div>
											<div class="comment-date">${comment.inDate}</div>
										</div>
										<div class="comment-text">${comment.content}</div>
										<div class="comment-button">
											<button type="button" class="button-detail button-mod" data-id="${comment.id}">ìˆ˜ì •</button>
											<button type="button" class="button-detail button-del" data-id="${comment.id}">ì‚­ì œ</button>
										</div>
										`;

					commentContainer.prepend(commentBox); // ë§¨ ìœ„ì— ì¶”ê°€
				}

				// ì…ë ¥ í•„ë“œ ì´ˆê¸°í™” ë° ëª¨ë‹¬ ë‹«ê¸°
				inputComment.value = '';
				modal.style.display = 'none';
				editingCommentId = null;

			} catch (err) {
				console.error(err);
				alert(editingCommentId ? 'ëŒ“ê¸€ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' : 'ëŒ“ê¸€ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
			}
		});

		// ìˆ˜ì •, ì‚­ì œ ì´ë²¤íŠ¸ ìœ„ì„
		if (commentContainer) {
			commentContainer.addEventListener('click', async (e) => {
				const target = e.target;

				// ì‚­ì œ
				if (target.classList.contains('button-del')) {
					e.preventDefault();
					const commentId = parseInt(target.dataset.id, 10); // ë¬¸ìì—´ì„ ìˆ«ìë¡œ ë³€í™˜
					if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

					fetch(`/community/delComment/${commentId}`, {method: 'DELETE'})
						.then(response => {
							if (!response.ok) throw new Error('ì‚­ì œ ì‹¤íŒ¨');
							target.closest('.comment-box').remove();
						})
						.catch(err => {
							console.error(err);
							alert('ëŒ“ê¸€ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
						});
				}

				// ìˆ˜ì •
				if (target.classList.contains('button-mod')) {
					e.preventDefault();
					const commentBox = target.closest('.comment-box');
					const commentId = parseInt(target.dataset.id, 10);
					const currentText = commentBox.querySelector('.comment-text').innerText;

					// ëª¨ë‹¬ ì—´ê³  ê¸°ì¡´ ë‚´ìš© ë„£ê¸°
					modal.style.display = 'block';
					inputComment.value = currentText;
					editingCommentId = commentId; // ìˆ˜ì • ëª¨ë“œ
				}
			})
		}
	});
</script>