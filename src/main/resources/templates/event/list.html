<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>ëŒ€íšŒ ëª©ë¡</title>

<style>
    body {
        font-family: Arial, sans-serif;
        line-height: 1.6;
        margin: 0;
        padding: 0;
        text-align: center;
    }

    .page-container {
        max-width: 900px;
        margin: 30px auto;
        padding: 0 20px;
    }

    table {
        margin: 20px auto;
        border-collapse: collapse;
        width: 80%;
    }

    th, td {
        padding: 10px;
        border: 1px solid #aaa;
        text-align: center;
    }

    h1 {
        margin-top: 30px;
    }

    .search-box {
        width: 80%;
        margin: 10px auto;
        display: flex;
        justify-content: center;
        gap: 8px;
    }

    #keyword {
        width: 220px;
        padding: 6px 8px;
    }
</style>
</head>

<body>

<header th:replace="~{fragment/header :: headerDiv}"></header>

<div class="page-container">

<!-- ì œëª© + ë²„íŠ¼ -->
<div style="width:80%; margin:0 auto; display:flex; justify-content:space-between; align-items:center;">
    <h1 style="margin:0;">ëŒ€íšŒ ëª©ë¡</h1>

    <a th:href="@{/trip/list}"
       style="text-decoration:none; color:#007bff; font-weight:bold; font-size:20px;">
        ì‹ ì²­í˜„í™© ë³´ê¸°
    </a>
</div>

<!-- ğŸ” ê²€ìƒ‰ ì˜ì—­ -->
<div class="search-box">
    <input type="text" id="keyword" placeholder="ëŒ€íšŒëª… ê²€ìƒ‰">
    <button onclick="searchEvents()">ê²€ìƒ‰</button>
</div>

<table>
<thead>
<tr>
    <th>No</th>
    <th>ëŒ€íšŒëª…</th>
    <th>ëŒ€íšŒì¥ì†Œ</th>
    <th>ì¼ì •</th>
    <th>ëŒ€íšŒê¸°ê´€</th>
</tr>
</thead>

<tbody id="eventTableBody">
<tr th:each="e, iterStat : ${eventList}">
    <td th:text="${iterStat.index + 1 + (pageVO.page - 1) * pageVO.size}"></td>

    <td>
        <a th:if="${isLogin}"
           th:href="@{/events/{id}/trips(id=${e.id})}"
           style="text-decoration:none; color:#007bff; font-weight:bold;"
           th:text="${e.title}">
        </a>

        <a th:if="${!isLogin}"
           href="#"
           onclick="alert('ë¡œê·¸ì¸ í›„ ì´ìš© ê°€ëŠ¥í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.'); return false;"
           style="text-decoration:none; color:#007bff; font-weight:bold;"
           th:text="${e.title}">
        </a>
    </td>

    <td th:text="${e.location}"></td>
    <td th:text="${e.startDate.format(T(java.time.format.DateTimeFormatter)
                    .ofPattern('yyyy-MM-dd HH:mm'))}"></td>
    <td th:text="${e.organizer}"></td>
</tr>
</tbody>
</table>

<!-- ================= ì¼ë°˜ ëª©ë¡ í˜ì´ì§• ================= -->
<div id="normalPaging" style="margin-top:20px;"> <!-- â˜… ìˆ˜ì • -->
    <a th:if="${pageVO.prev}"
       th:href="@{/events(page=${pageVO.startPage - 1})}">
        â—€
    </a>

    <span th:each="i : ${#numbers.sequence(pageVO.startPage, pageVO.endPage)}">
        <a th:if="${i != pageVO.page}"
           th:href="@{/events(page=${i})}"
           th:text="${i}"
           style="margin:0 5px;">
        </a>

        <strong th:if="${i == pageVO.page}"
                th:text="${i}"
                style="margin:0 5px;">
        </strong>
    </span>

    <a th:if="${pageVO.next}"
       th:href="@{/events(page=${pageVO.endPage + 1})}">
        â–¶
    </a>
</div>

<!-- ================= ê²€ìƒ‰ ê²°ê³¼ í•˜ë‹¨ ================= -->
<div id="searchFooter" style="margin-top:20px; display:none;"> <!-- â˜… ìˆ˜ì • -->
    <button onclick="window.history.go(-1)">ì•í˜ì´ì§€</button>
    <button onclick="goToList()">ëŒ€íšŒ ëª©ë¡ ëŒì•„ê°€ê¸°</button>
</div>

</div>

<!-- ================= JS ================= -->
<script>
let currentPage = 1;

// â˜… ê²€ìƒ‰ ì „ìš© í•¨ìˆ˜
function searchEvents(page = 1) {
    currentPage = page;
    const keyword = document.getElementById("keyword").value;

    fetch(`/events/search?page=${page}&keyword=${encodeURIComponent(keyword)}`)
        .then(res => res.json())
        .then(data => {
            renderTable(data.list);

            // â˜… ê²€ìƒ‰ ìƒíƒœë¡œ ì „í™˜
            document.getElementById("normalPaging").style.display = "none";
            document.getElementById("searchFooter").style.display = "block";
        })
        .catch(err => console.error(err));
}

// â˜… í…Œì´ë¸” ë Œë”ë§
function renderTable(list) {
    const tbody = document.getElementById("eventTableBody");
    tbody.innerHTML = "";

    list.forEach((event, index) => {
        tbody.innerHTML += `
            <tr>
                <td>${index + 1}</td>
                <td>
                    <a href="/events/${event.id}/trips"
                       style="text-decoration:none; color:#007bff; font-weight:bold;">
                       ${event.title}
                    </a>
                </td>
                <td>${event.location ?? ""}</td>
                <td>${event.startDate ?? ""}</td>
                <td>${event.organizer ?? ""}</td>
            </tr>
        `;
    });
}

// â˜… ëª©ë¡ ë³µê·€
function goToList() {
    location.href = "/events";
}

// â˜… ê²€ìƒ‰ ì´ì „ ìƒíƒœë¡œ ë³µê·€
function backToPrevious() {
    // í˜„ì¬ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ â†’ ê²€ìƒ‰ ì „ ìƒíƒœ ë³µì›
    location.reload();
}

</script>

</body>
</html>