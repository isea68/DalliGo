<!DOCTYPE html>
<html lang="ko">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>회원가입 | DalliGO</title>
	<style>
		body {
			margin: 0;
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
			background-color: #f4f7f9;
			color: #333;
		}

		/* 헤더 */
		header {
			background-color: #00acc1;
			color: white;
			padding: 15px 50px;
			display: flex;
			justify-content: space-between;
			align-items: center;
		}

		nav a {
			color: white;
			text-decoration: none;
			margin-left: 25px;
			font-weight: 500;
			transition: color 0.3s;
		}

		nav a:hover {
			color: #e0f7fa;
		}

		/* 회원가입 박스 */
		.signup-container {
			max-width: 450px;
			margin: 50px auto;
			background-color: white;
			padding: 30px;
			border-radius: 12px;
			box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
		}

		.signup-container h2 {
			text-align: center;
			margin-bottom: 20px;
			color: #00acc1;
		}

		.signup-container label {
			display: block;
			margin: 12px 0 5px;
			font-weight: 600;
		}

		.signup-container input {
			width: 93%;
			padding: 12px;
			border: 1px solid #ccc;
			border-radius: 6px;
			font-size: 1em;
		}

		.signup-container button {
			width: 100%;
			padding: 12px;
			margin-top: 20px;
			background-color: #00acc1;
			color: white;
			border: none;
			border-radius: 6px;
			font-size: 1.1em;
			cursor: pointer;
			transition: background 0.3s;
		}

		.signup-container button:hover {
			background-color: #00838f;
		}

		/* 로그인 이동 */
		.login-link {
			text-align: center;
			margin-top: 15px;
		}

		.login-link a {
			color: #00acc1;
			font-weight: bold;
			text-decoration: none;
		}

		.login-link a:hover {
			text-decoration: underline;
		}

		/* 버튼 옆 input 그룹 */
		.input-group {
			display: flex;
			gap: 8px;
			align-items: center;
		}

		.input-group input {
			flex: 1;
		}

		.input-group button {
			margin-top: 0px;
			width: 100px;
			padding: 8px;
			background: #00acc1;
			color: white;
			border: none;
			border-radius: 6px;
			cursor: pointer;
		}

		.input-group button:hover {
			background: #00838f;
		}

		.result-text {
			font-size: 0.9em;
			margin-top: 2px;
		}
	</style>
</head>

<body>
	<div th:replace="fragment/header :: headerDiv"></div>
	<div class="signup-container">
		<h2>회원가입</h2>
		<form id="signupForm" th:action="@{/signup}" method="post">
			<label>아이디</label>
			<div class="input-group">
				<input type="text" id="userId" name="userId" required placeholder="영문과 숫자만 입력 가능">
				<button type="button" onclick="checkUserId()">중복확인</button>
			</div>
			<small class="info-text">영문과 숫자만 입력 가능합니다. </small>
			<span id="userIdResult" class="result-text">
			</span>
			<!-- 비밀번호 -->
			<label>비밀번호</label>
			<input type="password" id="password" name="password" required placeholder="영문+숫자 조합">
			<label>비밀번호 확인</label>
			<input type="password" id="passwordConfirm" name="passwordConfirm" required placeholder="영문+숫자 조합">
			<small id="pwCheckMsg" class="result-text"> </small>
			<!-- 이름 -->
			<label>이름</label>
			<input type="text" id="name" name="name" required placeholder="한글만 입력 가능">
			<small class="info-text">한글만 입력 가능합니다. </small>
			<!-- 닉네임 + 중복확인 -->
			<label>닉네임</label>
			<div class="input-group">
				<input type="text" id="nickName" name="nickName" required>
				<button type="button" onclick="checkNickName()">중복확인</button>
			</div>
			<span id="nickNameResult" class="result-text"> </span>
			<!-- 주소 -->
			<label>주소</label>
			<div class="input-group">
				<input type="text" id="address" name="address" placeholder="도로명 주소" required>
				<button type="button" onclick="execDaumPostcode()">주소 검색</button>
			</div>
			<label>상세주소</label>
			<input type="text" id="detailAddress" name="detailAddress" placeholder="상세 주소를 입력하세요" required>
			<!-- 핸드폰 번호 -->
			<label>핸드폰 번호</label>
			<input type="text" name="phone" id="phone" maxlength="13" value="010-" required>
			<!-- 회원가입 버튼 -->
			<button type="submit">회원가입</button>
		</form>
		<div class="login-link"> 이미 계정이 있으신가요?
			<a th:href="@{/}">로그인</a>
		</div>
	</div>
	<!-- Daum 주소 검색 API -->
	<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
	<script>
		// ================== 아이디/닉네임 중복확인 ==================
		function checkUserId() {
			const userId = document.getElementById('userId').value;
			if (!userId) return alert("아이디를 입력하세요.");

			fetch(`/checkUserId?userId=${userId}`)
				.then(res => res.json())
				.then(data => {
					const result = document.getElementById('userIdResult');
					result.style.color = data.available ? "green" : "red";
					result.textContent = data.available ? "사용 가능한 아이디입니다." : "이미 사용 중인 아이디입니다.";
				});
		}

		function checkNickName() {
			const nickName = document.getElementById('nickName').value;
			if (!nickName) return alert("닉네임을 입력하세요.");

			fetch(`/checkNickName?nickName=${nickName}`)
				.then(res => res.json())
				.then(data => {
					const result = document.getElementById('nickNameResult');
					result.style.color = data.available ? "green" : "red";
					result.textContent = data.available ? "사용 가능한 닉네임입니다." : "이미 사용 중인 닉네임입니다.";
				});
		}

		const userIdInput = document.getElementById("userId");
		const nameInput = document.getElementById("name");
		const pwInput = document.getElementById("password");
		const pwConfirmInput = document.getElementById("passwordConfirm");
		const pwMsg = document.getElementById("pwCheckMsg");

		// 아이디: 영문+숫자만 허용
		userIdInput.addEventListener("input", function () {
			this.value = this.value.replace(/[^A-Za-z0-9]/g, "");
		});

		// 이름: 한글만 허용
		let isComposing = false;

		nameInput.addEventListener("compositionstart", () => {
		    isComposing = true;
		});
		nameInput.addEventListener("compositionend", (e) => {
		    isComposing = false;
		    e.target.value = e.target.value.replace(/[^가-힣]/g, ""); // 조합 끝난 후 필터링
		});
		nameInput.addEventListener("input", function () {
		    if (!isComposing) {
		        this.value = this.value.replace(/[^가-힣]/g, "");
		    }
		});
		// 비밀번호: 영문+숫자만 허용, 최소 6자리 체크
		function validatePasswordInput() {
			this.value = this.value.replace(/[^A-Za-z0-9]/g, "");
			checkPasswordMatch();
		}

		pwInput.addEventListener("input", validatePasswordInput);
		pwConfirmInput.addEventListener("input", validatePasswordInput);

		function checkPasswordMatch() {
			if (!pwInput.value || !pwConfirmInput.value) {
				pwMsg.textContent = "";
				return;
			}
			if (pwInput.value.length < 6) {
				pwMsg.style.color = "red";
				pwMsg.textContent = "비밀번호는 최소 6자리 이상이어야 합니다.";
				return;
			}
			if (pwInput.value === pwConfirmInput.value) {
				pwMsg.style.color = "green";
				pwMsg.textContent = "비밀번호가 일치합니다 ✔";
			} else {
				pwMsg.style.color = "red";
				pwMsg.textContent = "비밀번호가 일치하지 않습니다 ❌";
			}
		}
		// ================== Daum 주소 검색 ==================
		function execDaumPostcode() {
			new daum.Postcode({
				oncomplete: function (data) {
					let fullRoadAddr = data.roadAddress;
					let extraRoadAddr = '';

					if (data.bname && /[동|로|가]$/g.test(data.bname)) extraRoadAddr += data.bname;
					if (data.buildingName && data.apartment === 'Y') {
						extraRoadAddr += (extraRoadAddr ? ', ' + data.buildingName : data.buildingName);
					}
					if (extraRoadAddr) fullRoadAddr += ' (' + extraRoadAddr + ')';

					document.getElementById("address").value = fullRoadAddr;
					document.getElementById("detailAddress").focus();
				}
			}).open();
		}

		// ================== 핸드폰 번호 자동 포맷 ==================
		const phone = document.getElementById("phone");
		phone.addEventListener("input", () => {
			if (!phone.value.startsWith("010-")) phone.value = "010-";
			let rest = phone.value.replace("010-", "").replace(/[^0-9]/g, "");
			rest = rest.substring(0, 8);
			phone.value = rest.length > 4 ? "010-" + rest.slice(0, 4) + "-" + rest.slice(4) : "010-" + rest;
		});
		phone.addEventListener("focus", () => {const val = phone.value; phone.value = ""; phone.value = val;});

		// ================== 회원가입 확인 팝업 ==================
		const form = document.getElementById("signupForm");
		form.addEventListener("submit", (e) => {
			e.preventDefault();

			// 최종 검증
			if (pwInput.value.length < 6) {
				alert("비밀번호는 최소 6자리 이상이어야 합니다.");
				pwInput.focus();
				return;
			}
			if (pwInput.value !== pwConfirmInput.value) {
				alert("비밀번호가 일치하지 않습니다.");
				pwConfirmInput.focus();
				return;
			}

			if (confirm("회원가입을 진행하시겠습니까?")) {
				form.submit();
			}
		});
	</script>
</body>


</html>