<!DOCTYPE html>
<html lang="ko">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>대회 일정</title>
	<style>
		body {
			font-family: 'Segoe UI', Tahoma;
			margin: 0;
			background-color: #f4f7f9;
		}

		.sort-container {
			display: flex;
			gap: 12px;
			background: #f8f9fa;
			padding: 12px 18px;
			border: 1px solid #e2e2e2;
		}

		.sort-btn {
			padding: 8px 16px;
			border-radius: 8px;
			text-decoration: none;
			border: 1px solid #d1d1d1;
			color: #444;
		}

		.sort-btn.active {
			background: #007bff;
			color: #fff;
			font-weight: bold;
		}

		.container {
			max-width: 900px;
			margin: auto;
			padding: 30px 20px;
		}

		.card {
			background: #fff;
			border-radius: 10px;
			padding: 20px;
			margin-bottom: 25px;
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
		}

		.map {
			width: 100%;
			height: 300px;
			border-radius: 10px;
			margin-top: 12px;
		}
	</style>
</head>

<body>

	<div th:replace="fragment/header :: headerDiv"></div>

	<h1 style="text-align:center;">대회 일정 상세</h1>

	<!-- 정렬 -->
	<div class="sort-container">
		<a th:href="@{|/schedule?sort=desc|}" class="sort-btn"
			th:classappend="${sort} == 'desc' ? ' active' : ''">최신순</a>
		<a th:href="@{|/schedule?sort=asc|}" class="sort-btn"
			th:classappend="${sort} == 'asc' ? ' active' : ''">오래된순</a>
		<a th:href="@{|/schedule?sort=future|}" class="sort-btn"
			th:classappend="${sort} == 'future' ? ' active' : ''">진행 예정만</a>
	</div>

	<div class="container" id="marathon-list">

		<!-- 카드 + 지도 반복 -->
		<div class="card" th:each="event : ${events}">
			<h2 th:text="${event.title}">대회명</h2>

			<p><strong>날짜:</strong>
				<span th:text="${#temporals.format(event.startDate,'yyyy-MM-dd')}"></span>
			</p>

			<p><strong>장소:</strong>
				<span th:text="${event.location}"></span>
			</p>

			<p><strong>러닝 종목:</strong>
				<span th:text="${event.distance}"></span>
			</p>

			<p><strong>참가비:</strong>
				<span th:text="${event.price + ' 원'}"></span>
			</p>

			<p><strong>주관 기관:</strong>
				<a th:href="${event.regURL}" th:text="${event.org}" target="_blank"></a>
			</p>

			<!-- 주소 데이터 포함 -->
			<div class="map" th:data-location="${event.location}"></div>
		</div>

	</div>

	<!-- 카카오 지도 SDK -->
	<script
		src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=9330492191b0fcacf92925ab65192185&autoload=false&libraries=services"></script>

	<script>
		kakao.maps.load(function () {
			const geocoder = new kakao.maps.services.Geocoder();
			const mapElements = document.querySelectorAll(".map");

			mapElements.forEach(mapEl => {
				const address = mapEl.getAttribute("data-location");

				const map = new kakao.maps.Map(mapEl, {
					center: new kakao.maps.LatLng(37.5665, 126.9780),
					level: 6
				});

				geocoder.addressSearch(address, function (result, status) {
					if (status === kakao.maps.services.Status.OK) {
						const coords = new kakao.maps.LatLng(result[0].y, result[0].x);
						new kakao.maps.Marker({map, position: coords});
						map.setCenter(coords);
					}
				});
			});
		});
	</script>

</body>

</html>