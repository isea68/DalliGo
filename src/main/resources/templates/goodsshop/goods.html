<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
	<style>
		header {
			display: flex;
			align-items: center;
			justify-content: space-between;
			padding: 10px 20px;
			border-bottom: 1px solid #ccc;
			gap: 30px;
		}

		#logoname {
			font-size: 28px;
			font-weight: bold;
			text-align: left;
			flex-grow: 1;
		}

		#logo img {
			width: 60px;
			height: 60px;
		}

		nav {
			float: right;
		}

		table {
			border: solid 1px black;
			width: 150px;
			float: left;
			margin-right: 10px;
		}

		select {
			text-align: right;
			float: right;
		}

		#goodslist {
			margin-left: 180px;
			/* 필터 테이블 옆에 위치 */
			width: calc(100% - 180px);
			display: flex;
			flex-wrap: wrap;
			gap: 20px;
			overflow-y: auto;
			max-height: 600px;
		}

		.goods {
			flex: 0 0 calc(45% - 30px);
			/* 3열 레이아웃 */
			display: flex;
			gap: 10px;
			border: 1px solid #ccc;
			padding: 10px;
			border-radius: 5px;
			background-color: #f9f9f9;
		}

		img {
			width: 150px;
			height: 150px;
			object-fit: cover;
			border: 1px solid #ccc;
			border-radius: 5px;
		}

		#basketbtn:hover {
			background-color: black;
		}

		#basketbtn img {
			width: 30px;
			height: 30px;
		}

		#jeokyongbtn {
			float: right;
		}

		#topRanking {
			display: flex;
			justify-content: center;
			gap: 20px;
			margin-bottom: 20px;
		}

		.rankingBox {
			display: flex;
			flex-direction: column;
			align-items: center;
			gap: 5px;
		}

		.rankLabel {
			font-size: 18px;
			font-weight: bold;
			color: #444;
		}

		.ranking {
			width: 200px;
			height: 200px;
			border: 1px solid black;
			border-radius: 10px;
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 28px;
			font-weight: bold;
			background-color: #fff8d1;
		}

		.modal {
			display: none;
			position: fixed;
			z-index: 1000;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			overflow: auto;
			background-color: rgba(0, 0, 0, 0.5);
		}

		.modal-content {
			background-color: #fff;
			margin: 10% auto;
			padding: 20px;
			border-radius: 10px;
			width: 400px;
			text-align: center;
			position: relative;
		}

		.close {
			position: absolute;
			top: 10px;
			right: 15px;
			font-size: 28px;
			font-weight: bold;
			cursor: pointer;
		}

		.close:hover {
			color: red;
		}

		.cart-modal {
			display: none;
			position: fixed;
			z-index: 999;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			background: rgba(0, 0, 0, 0.3);
		}

		/* 모달 박스 */
		.cart-modal-content {
			background: #fff;
			width: 350px;
			margin: 100px auto;
			padding: 20px;
			border-radius: 8px;
			position: relative;
		}

		.cart-close {
		    position: absolute;
		    top: 10px;
		    right: 15px;
		    font-size: 28px;
		    font-weight: bold;
		    cursor: pointer;
		}

		#cartItems div {
			padding: 8px 0;
			border-bottom: 1px solid #ddd;
		}

		.cart-footer {
			margin-top: 20px;
			padding-top: 10px;
		}

		#cartModal .close {
			position: absolute;
			top: 10px;
			right: 15px;
			font-size: 26px;
			font-weight: bold;
			cursor: pointer;
		}

		#cartModal .close:hover {
			color: red;
		}

		#checkoutBtn {
			width: 100%;
			padding: 10px;
			font-size: 16px;
			font-weight: bold;
			background-color: black;
			color: white;
			border: none;
			border-radius: 5px;
			cursor: pointer;
		}
	</style>
</head>

<body>

	<header>
		<div th:replace="fragments/header :: headerDiv"></div>
		
	</header>
	<div>
				<nav>
							<input type="text" placeholder="검색어를 입력하세요" id="search">
							<button id="searchBtn">검색</button>
							<button id="basketbtn">
								<img
									src="https://w7.pngwing.com/pngs/742/249/png-transparent-shopping-cart-bag-shopping-cart-thumbnail.png">
							</button>
							<div id="cartModal" class="cart-modal">
								<div class="cart-modal-content">
									<span id="closeCart" class="close">&times;</span>
									<h2>장바구니</h2>

									<div id="cartItems"></div>

									<div class="cart-footer">
										<strong>총 금액: <span id="cartTotal">0</span> 원</strong>
										<br><br>
										<button id="checkoutBtn" >
											결제하기
										</button>
									</div>
								</div>
							</div>
						</nav>
			</div>
	<table>
		<thead>
			<tr>
				<th>필터</th>
			</tr>
		</thead>
		<tbody>
			<tr>
			    <td>종류
			        <select id="filterTag"> <!-- 기존 filterType → filterTag -->
			            <option value="">선택안함</option>
			            <option th:each="tag : ${tagList}" th:value="${tag}" th:text="${tag}"></option>
			        </select>
			    </td>
			</tr>
			<tr>
			    <td>브랜드
			        <select id="filterBrand">
			            <option value="">선택안함</option>
			            <option th:each="brand : ${brandList}" th:value="${brand}" th:text="${brand}"></option>
			        </select>
			    </td>
			</tr>
			<tr>
			    <td>가격대, <span id="priceText">150,000</span>원
			        <input class="range" id="priceRange" type="range" min="0" max="300000" step="5000" value="150000" />
			    </td>
			</tr>
			<tr>
			    <td>
			        <input type="button" value="적용" id="jeokyongbtn">
			        <input type="button" value="초기화" id="resetbtn">
			    </td>
			</tr>
		</tbody>
	</table>

	<div id="topRanking">
		<div class="rankingBox" th:each="goods, iterStat : ${topGoodsList}">
			<div class="rankLabel" th:text="'TOP' + ${iterStat.index + 1}">TOP1</div>
			<div class="ranking">
				<img th:if="${goods.goodsImage != null}" th:src="${goods.goodsImage}" th:alt="${goods.goodsName}"
					style="width: 200px; height: 200px;">
				<span th:if="${goods.goodsImage == null}" th:text="${goods.goodsName}">상품명</span>
			</div>
		</div>
	</div>

	<div id="goodslist">
		<div class="goods" th:each="goods : ${goodsList}">
			<img th:src="${goods.goodsImage}" alt="상품 이미지">
			<div style="display: flex; flex-direction: column; gap: 5px; flex-grow: 1;">
				<div><strong>상품명:</strong> <span th:text="${goods.goodsName}"></span></div>
				<div><strong>브랜드:</strong> <span th:text="${goods.goodsBrand}"></span></div>
				<div><strong>가격:</strong> <span
						th:text="${#numbers.formatDecimal(goods.goodsPrice, 0, 'COMMA', 0, 'POINT')} + '원'"></span>
				</div>
				<div><strong>수량:</strong> <span th:text="${goods.goodsQuantity}"></span></div>
				<div><strong>태그:</strong> <span th:text="${goods.goodsTag}"></span></div>
				<div><strong>설명:</strong> <span th:text="${goods.goodsInfo}"></span></div>
				<div style="display: flex; justify-content: flex-end;">
					<button class="add-to-cart-btn" th:data-id="${goods.goodsId}" th:data-name="${goods.goodsName}"
						th:data-price="${goods.goodsPrice}">
						담기
					</button>
				</div>
			</div>
		</div>
	</div>

	<script>
		const priceRange = document.getElementById("priceRange");
		const priceText = document.getElementById("priceText");

		priceRange.addEventListener("input", function () {
			priceText.textContent = Number(priceRange.value).toLocaleString();
		});

		/* -----------------------------
		   장바구니 기능
		------------------------------ */

		const cart = [];

		const basketBtn = document.getElementById("basketbtn");   // 장바구니 아이콘 버튼
		const cartModal = document.getElementById("cartModal");   // 모달
		const closeCart = document.getElementById("closeCart");   // 닫기 버튼

		// 장바구니 모달 열기
		basketBtn.addEventListener("click", () => {
			cartModal.style.display = "block";
			renderCart(); // 모달 열릴 때 최신 목록 출력
		});

		// 모달 닫기
		closeCart.addEventListener("click", () => {
			cartModal.style.display = "none";
		});

		window.addEventListener("click", (e) => {
			if (e.target === cartModal) {
				cartModal.style.display = "none";
			}
		});

		// "담기" 버튼 이벤트 등록
		document.querySelectorAll(".add-to-cart-btn").forEach(btn => {
			btn.addEventListener("click", () => {
				const id = btn.dataset.id;
				const name = btn.dataset.name;
				const price = parseInt(btn.dataset.price);

				let item = cart.find(x => x.id === id);

				if (item) {
					item.qty++;
				} else {
					cart.push({id, name, price, qty: 1});
				}

				alert("장바구니에 담았습니다!");
			});
		});

		// 장바구니 목록 출력
		function renderCart() {
			const container = document.getElementById("cartItems");
			container.innerHTML = "";

			let total = 0;

			cart.forEach((item, index) => {
				total += item.price * item.qty;

				container.innerHTML += `
		            <div style="display:flex; justify-content:space-between; align-items:center;">
		                <div>
		                    ${item.name}  
		                    <br>
		                    <small>${(item.price * item.qty).toLocaleString()} 원</small>
		                </div>

		                <div>
		                    <button class="qty-btn" data-index="${index}" data-type="minus">-</button>
		                    <span style="margin: 0 8px;">${item.qty}</span>
		                    <button class="qty-btn" data-index="${index}" data-type="plus">+</button>
		                </div>
		            </div>
		        `;
			});

			document.getElementById("cartTotal").innerText = total.toLocaleString();

			// 수량 조절 버튼 이벤트 등록
			document.querySelectorAll(".qty-btn").forEach(btn => {
				btn.addEventListener("click", () => {
					const index = btn.dataset.index;
					const type = btn.dataset.type;

					if (type === "plus") {
						cart[index].qty++;
					} else if (type === "minus") {
						cart[index].qty--;
						if (cart[index].qty <= 0) {
							cart.splice(index, 1); // 수량 0이면 삭제
						}
					}

					renderCart(); // 다시 렌더링
				});
			});
		}
		const searchInput = document.getElementById("search");
		const searchBtn = document.getElementById("searchBtn");


		// 검색 실행 함수
		function searchGoods() {
			const goodsList = document.querySelectorAll(".goods");
			const keyword = searchInput.value.trim().toLowerCase();

			goodsList.forEach(goods => {
				const name = goods.querySelector("div strong + span").innerText.toLowerCase();

				// 검색어 포함 → 보여주기
				if (name.includes(keyword) || keyword === "") {
					goods.style.display = "flex";
				} else {
					goods.style.display = "none";
				}
			});
		}

		// 엔터 입력 시 검색
		searchInput.addEventListener("keypress", (e) => {
			if (e.key === "Enter") {
				searchGoods();
			}
		});

		// 버튼 클릭 시 검색
		searchBtn.addEventListener("click", searchGoods);
		document.addEventListener('DOMContentLoaded', () => {
		    const priceRange = document.getElementById('priceRange');
		    const priceText = document.getElementById('priceText');
		    const jeokyongbtn = document.getElementById('jeokyongbtn');
		    const resetbtn = document.getElementById('resetbtn');

		    priceRange.addEventListener('input', () => {
		        priceText.textContent = Number(priceRange.value).toLocaleString();
		    });

		    jeokyongbtn.addEventListener('click', (event) => {
		        event.preventDefault(); // 폼 제출 막기

		        const tag = document.getElementById('filterTag').value;
		        const brand = document.getElementById('filterBrand').value;
		        const maxPrice = priceRange.value;

		        let url = '/store?';
		        const params = [];
		        if(tag) params.push('category=' + encodeURIComponent(tag));
		        if(brand) params.push('brand=' + encodeURIComponent(brand));
		        params.push('minPrice=0');
		        params.push('maxPrice=' + encodeURIComponent(maxPrice));

		        url += params.join('&');
		        window.location.href = url;
		    });

		    resetbtn.addEventListener('click', () => {
		        window.location.href = '/store';
		    });
		});
		function renderGoods(goodsList) {
		    const container = document.getElementById("goodslist");
		    container.innerHTML = ""; // 기존 상품 제거

		    goodsList.forEach(goods => {
		        container.innerHTML += `
		        <div class="goods">
		            <img src="${goods.goodsImage}" alt="상품 이미지">
		            <div style="display:flex; flex-direction:column; gap:5px;">
		                <div><strong>상품명:</strong> ${goods.goodsName}</div>
		                <div><strong>브랜드:</strong> ${goods.goodsBrand}</div>
		                <div><strong>가격:</strong> ${goods.goodsPrice.toLocaleString()}원</div>
		                <div><strong>수량:</strong> ${goods.goodsQuantity}</div>
		                <div><strong>태그:</strong> ${goods.goodsTag}</div>
		                <div><strong>설명:</strong> ${goods.goodsInfo}</div>
		                <button class="add-to-cart-btn"
		                    data-id="${goods.goodsId}"
		                    data-name="${goods.goodsName}"
		                    data-price="${goods.goodsPrice}">
		                    담기
		                </button>
		            </div>
		        </div>
		        `;
		    });

		    // 다시 "담기" 이벤트 연결
		    document.querySelectorAll(".add-to-cart-btn").forEach(btn => {
		        btn.addEventListener("click", () => {
		            const id = btn.dataset.id;
		            const name = btn.dataset.name;
		            const price = parseInt(btn.dataset.price);

		            const item = cart.find(x => x.id === id);

		            if (item) item.qty++;
		            else cart.push({ id, name, price, qty: 1 });

		            alert("장바구니에 담았습니다!");
		            renderCart();
		        });
		    });
		}
		document.addEventListener('DOMContentLoaded', () => {
		    const priceRange = document.getElementById('priceRange');
		    const priceText = document.getElementById('priceText');
		    const jeokyongbtn = document.getElementById('jeokyongbtn');
		    const resetbtn = document.getElementById('resetbtn');

		    // 가격 표시 업데이트
		    priceRange.addEventListener('input', () => {
		        priceText.textContent = Number(priceRange.value).toLocaleString();
		    });

		    // 필터 적용
		    

		    // 초기화 버튼
		    resetbtn.addEventListener('click', () => {
		        window.location.href = '/store';
		    });
		});
	</script>


</body>

</html>