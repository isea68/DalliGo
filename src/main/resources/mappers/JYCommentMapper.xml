<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.human.dalligo.dao.community.JYCommentDAO">

	<!-- 자세히 보기 게시글의 댓글 -->
	<resultMap id="ResultComment" type="com.human.dalligo.vo.community.JYCommentVO">
		<id property="id" column="id"/>
		<result property="postId" column="post_id"/>
		<result property="userId" column="user_id"/>
		<result property="userFk" column="user_fk"/>
		<result property="nickName" column="nick_name"/>
		<result property="content" column="content"/>
		<result property="inDate" column="in_date"/>
	</resultMap>
	
	<insert id="insertComment" parameterType="com.human.dalligo.vo.community.JYCommentVO"
			useGeneratedKeys="true" keyProperty="id">
		INSERT INTO post_comments (post_id, user_fk, content) VALUES (#{postId}, #{userFk}, #{content}) 
	</insert>
	
	<select id="selectCommentsById" parameterType="int" resultMap="ResultComment">
		SELECT c.id, c.post_id, c.user_fk, u.user_id AS user_id, u.nick_name AS nick_name, c.content, c.in_date 
		FROM post_comments c JOIN user u ON c.user_fk = u.id
		WHERE c.post_id = #{postId}
		ORDER BY c.in_date DESC
	</select>
	
	<select id="selectOneCommentById" parameterType="int" resultMap="ResultComment">
		SELECT c.id, c.post_id, c.user_fk, u.user_id, u.nick_name, c.content, c.in_date
		FROM post_comments c JOIN user u ON c.user_fk = u.id
		WHERE c.id = #{id}
	</select>
	
		<update id="updateComment" parameterType="com.human.dalligo.vo.community.JYCommentVO">
		UPDATE post_comments SET content = #{content}, in_date = NOW()
		WHERE id = #{id}
	</update>
	
	<delete id="deleteComment" parameterType="int">
		DELETE FROM post_comments WHERE id = #{id}
	</delete>
	
</mapper>